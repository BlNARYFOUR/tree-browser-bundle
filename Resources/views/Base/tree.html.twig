<script type="text/javascript" src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script type="text/javascript" src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>

<script src="{{ asset('bundles/symfonycmftree/js/jstree/jquery.jstree.js') }}" type="text/javascript"></script>

<script type="text/javascript">
    
    function initTree(selector) {

        jQuery(selector).jstree({ 
            "plugins" :     [ "contextmenu", "themes", "types", "ui", "json_data" ],
            "json_data": {
                "ajax": {
                    url:    Routing.generate('symfony_cmf_phpcr_browser_children'),
                    data:   function (node) {
                        return { 'root' : jQuery(node).attr('id') };
                    }
                }
            },
            "types": {
                "max_depth":        -2,
                "max_children":     -2,
                "valid_children":  [ "folder" ],
                "types": {
                    "default": {
                        "valid_children": "none",
                        "icon": {
                            "image": "{{ asset('bundles/symfonycmftree/images/document.png') }}"
                        }
                    },
                    "folder": {
                        "valid_children": [ "default", "folder" ],
                        "icon": {
                            "image": "{{ asset('bundles/symfonycmftree/images/folder.png') }}"
                        }
                    }
                }
            },
            "contextmenu": {
                "items": {
                    "rename":   null,
                    "remove":   null,
                    "ccp":      null,
                    "create": {
                        "label":    "Create",
                        "action":   function (node) {
                                        window.location = Routing.generate('admin_sandbox_main_editablestaticcontent_create', { "id": node.attr("id") })
                                    }
                    },
                    "delete": {
                        "label":    "Delete",
                        "action":   function (node) {
                                        window.location = Routing.generate('admin_sandbox_main_editablestaticcontent_delete', { "id": node.attr("id") })
                                    }
                    }
                }
            }
        })
        .bind("select_node.jstree", function (event, data) {
            window.location = Routing.generate('admin_sandbox_main_editablestaticcontent_edit', { "id": data.rslt.obj.attr("id") });
        })
        .delegate("a", "click", function (event, data) { event.preventDefault(); });
    }

    $(document).ready(function() {
        initTree("{{ selector }}");
    });

</script>